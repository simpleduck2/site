Bridge.assembly("LunaUnity",(function(e,n){"use strict";var t=/\+/g;Bridge.define("LunaUnity.Objects.Request",{ctor:function(){this.$initialize(),this.immediateRegistry=null,this.referenceQueue=[],this.pendingQueue=[],this.root=null,LunaUnity.Objects.Request.typeCache=LunaUnity.Objects.Request.typeCache||{}},r:function(e,n,t,i,r){var a={type:null==e?null:"boolean"==typeof e?e:Deserializers.types[e],id:n,targetType:t,targetObject:i,targetProperty:r};this.immediateRegistry?this.resolveInstruction(this.immediateRegistry,a):this.referenceQueue.push(a)},resolveReferences:function(e){for(var n=0;n<this.referenceQueue.length;n++)this.resolveInstruction(e,this.referenceQueue[n]);this.referenceQueue=this.pendingQueue,this.pendingQueue=[]},resolveInstruction:function(e,n){if(null!==n.type&&null!==n.id){var t=e.TryGet(n.id);if(t){var i=!0===n.type?null:this._getTypeByName(n.type),r=t;!i||r.$kind||r.isPrefabProxy||(r=UnityEngine.Object.FromHandle(i,t)),this.applyObject(n,r)}else this.pendingQueue.push(n)}else this.applyObject(n,null)},applyObject:function(e,n){0===e.targetType?e.targetObject[e.targetProperty]=n:1===e.targetType?e.targetObject.add(n):e.targetObject.push(n)},d:function(e,n,t){return null==n?null:Deserializers[e](this,n,t)},deserializeTo:function(e,n,t){return Deserializers[t||n.$$fullname](this,e,n)},c:function(e){var n=this._getTypeByName(e);if(!n||!n.$$fullname)return{};if(n.ctor&&0===n.ctor.length)return new n.ctor;var t=Object.create(n.prototype);return t.$initialize&&t.$initialize(),t},_getTypeByName:function(e){var n=LunaUnity.Objects.Request.typeCache;if(!n.hasOwnProperty(e)){var i=Bridge.ns(e.replace(t,"."));i.$$fullname||(console.warn("Unknown class found: "+e),i=null),n[e]=i}return n[e]}}),Bridge.define("LunaUnity.Objects.ImmediateRequest",{inherits:[LunaUnity.Objects.Request],ctor:function(e){LunaUnity.Objects.Request.ctor.call(this),this.registry=e},r:function(e,n,t,i,r){if(null!==e&&null!==n){var a={type:"boolean"==typeof e?e:Deserializers.types[e],id:n,targetType:t,targetObject:i,targetProperty:r};this.resolveInstruction(this.registry,a)}}})})),Bridge._getTypeByName=LunaUnity.Objects.Request.prototype._getTypeByName,Bridge.assembly("LunaUnity",(function(e,n){"use strict";Bridge.define("LunaUnity.Objects.Handlers.Base",{ctors:{ctor:function(e){this.$initialize(),this.application=e,this.network=e.network,this.objectSpace=e.objectSpace,this.app=e.app,this.graphicsDevice=this.app.graphicsDevice,this.registry=this.objectSpace.getRegistry()}},methods:{loadAsync:function(){throw new Error("Not implemented")}}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";var t=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Scene.GameObject"],i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Transform"],r=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Animator"],a=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Animation"],o=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Canvas"],s=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.CanvasGroup"],l=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.RectTransform"],c=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Camera"],d=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.VideoPlayer"],u=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.AudioSource"],y=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Light"],p=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.MeshFilter"],g=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.MeshRenderer"],h=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.SkinnedMeshRenderer"],m=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.SpriteRenderer"],f=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Rigidbody"],C=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.BoxCollider"],b=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.SphereCollider"],_=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.MeshCollider"],T=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.CapsuleCollider"],U=(Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.WheelCollider"],Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.Rigidbody2D"]),A=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.BoxCollider2D"],E=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.CircleCollider2D"],D=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.CapsuleCollider2D"],R=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.EdgeCollider2D"],O=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.PolygonCollider2D"],L=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.SpringJoint2D"],v=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.DistanceJoint2D"],w=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.FixedJoint2D"],S=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.HingeJoint2D"],F=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.WheelJoint2D"],P=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.FrictionJoint2D"],B=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.RelativeJoint2D"],M=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.SliderJoint2D"],I=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.TargetJoint2D"],x=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.LineRenderer"],k=(Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.ReflectionProbe"],Deserializers.fields["Luna.Unity.DTO.UnityEngine.Components.TrailRenderer"]);new pc.Vec2,new pc.Vec4,new pc.Vec2,new pc.Vec2;Bridge.define("LunaUnity.Objects.Handlers.GameObject",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},fork:function(){var e=new LunaUnity.Objects.Handlers.GameObject(this.application);return e.registry=e.registry.Clone().AllowUpdate(),e},loadAsync:function(e,n,t,i){if(!this.app.systems.monoBehaviour.creatingPrefabs||i){var r=this._loadObject(e,e.root,n,this.registry);return r.isPrefab=!0,r.objectJson=n,{result:r}}var a={isPrefabProxy:!0,prefab:n};return this.registry.Put(n.id,a),{result:a}},_loadObject:function(e,n,i,r){if(r.Has(i.id)&&!r.updatesAllowed)return r.Get(i.id);var a=i.data,o=new pc.Entity(a[t.name],this.app,this.app.systems.monoBehaviour.creatingPrefabs);o.enabled=!!a[t.enabled],o.cullingLayer=a[t.layer],o.static=!!a[t.isStatic],o.tags.add(a[t.tag]),o.isPrefab&&(o.objectJson=i);for(var s=i.children,l=0;l<s.length;l++)this._loadObject(e,o,s[l],this.registry);var c=i.components,d=Deserializers.typeNameToIdMap["UnityEngine.CanvasRenderer"];for(l=0;l<c.length;l++)c[l].type==d&&l>1&&([c[1],c[l]]=[c[l],c[1]]);for(l=0;l<c.length;l++)this._loadComponent(e,o,c[l],this.registry);return null!=n&&n.addChild(o),r.Put(i.id,o)},unloadAsync:function(e){this.registry.Release(e.id);for(var n=0;n<e.components.length;n++)this.registry.Release(e.components[n].id);for(n=0;n<e.children.length;n++)this.unloadAsync(e.children[n])},_loadComponent:function(e,n,t,i){var r=null;switch(Deserializers.types[t.type]){case"UnityEngine.Transform":r=this._loadTransformComponent(e,n,t,i);break;case"UnityEngine.Animator":r=this._loadAnimatorComponent(e,n,t,i);break;case"UnityEngine.Animation":r=this._loadAnimationComponent(e,n,t,i);break;case"UnityEngine.Canvas":r=this._loadCanvasComponent(e,n,t,i);break;case"UnityEngine.CanvasGroup":r=this._loadCanvasGroupComponent(e,n,t,i);break;case"UnityEngine.EventSystems.UIBehaviour":r=this._loadUIBehaviourComponent(e,n,t,i);break;case"UnityEngine.TextMesh":r=this._loadTextMesh(e,n,t,i);break;case"UnityEngine.RectTransform":r=this._loadRectTransformComponent(e,n,t,i);break;case"UnityEngine.Camera":r=this._loadCameraComponent(e,n,t,i);break;case"UnityEngine.Video.VideoPlayer":r=this._loadVideoPlayerComponent(e,n,t,i);break;case"UnityEngine.AudioSource":r=this._loadAudioSourceComponent(e,n,t,i);break;case"UnityEngine.Light":r=this._loadLightComponent(e,n,t,i);break;case"UnityEngine.MeshFilter":r=this._loadMeshFilterComponent(e,n,t,i);break;case"UnityEngine.SkinnedMeshRenderer":r=this._loadSkinnedMeshRendererComponent(e,n,t,i);break;case"UnityEngine.MeshRenderer":r=this._loadMeshRendererComponent(e,n,t,i);break;case"UnityEngine.SpriteRenderer":r=this._loadSpriteRendererComponent(e,n,t,i);break;case"UnityEngine.MonoBehaviour":r=this._loadMonoBehaviourComponent(e,n,t,i);break;case"UnityEngine.Rigidbody":r=this._loadRigidbodyComponent(e,n,t,i);break;case"UnityEngine.BoxCollider":r=this._loadBoxColliderComponent(e,n,t,i);break;case"UnityEngine.SphereCollider":r=this._loadSphereColliderComponent(e,n,t,i);break;case"UnityEngine.MeshCollider":r=this._loadMeshColliderComponent(e,n,t,i);break;case"UnityEngine.CapsuleCollider":r=this._loadCapsuleColliderComponent(e,n,t,i);break;case"UnityEngine.WheelCollider":r=this._loadWheelColliderComponent(e,n,t,i);break;case"UnityEngine.CharacterController":r=this._loadCharacterControllerComponent(e,n,t,i);break;case"UnityEngine.Rigidbody2D":r=this._loadRigidbody2DComponent(e,n,t,i);break;case"UnityEngine.BoxCollider2D":r=this._loadBoxCollider2DComponent(e,n,t,i);break;case"UnityEngine.CircleCollider2D":r=this._loadCircleCollider2DComponent(e,n,t,i);break;case"UnityEngine.CapsuleCollider2D":r=this._loadCapsuleCollider2DComponent(e,n,t,i);break;case"UnityEngine.EdgeCollider2D":r=this._loadEdgeCollider2DComponent(e,n,t,i);break;case"UnityEngine.PolygonCollider2D":r=this._loadPolygonCollider2DComponent(e,n,t,i);break;case"UnityEngine.SpringJoint2D":r=this._loadSpringJoint2DComponent(e,n,t,i);break;case"UnityEngine.DistanceJoint2D":r=this._loadDistanceJoint2DComponent(e,n,t,i);break;case"UnityEngine.FixedJoint2D":r=this._loadFixedJoint2DComponent(e,n,t,i);break;case"UnityEngine.HingeJoint2D":r=this._loadHingeJoint2DComponent(e,n,t,i);break;case"UnityEngine.WheelJoint2D":r=this._loadWheelJoint2DComponent(e,n,t,i);break;case"UnityEngine.FrictionJoint2D":r=this._loadFrictionJoint2DComponent(e,n,t,i);break;case"UnityEngine.RelativeJoint2D":r=this._loadRelativeJoint2DComponent(e,n,t,i);break;case"UnityEngine.SliderJoint2D":r=this._loadSliderJoint2DComponent(e,n,t,i);break;case"UnityEngine.TargetJoint2D":r=this._loadTargetJoint2DComponent(e,n,t,i);break;case"UnityEngine.ParticleSystem":r=this._loadParticleSystemComponent(e,n,t,i);break;case"UnityEngine.ParticleSystemRenderer":r=this._loadParticleSystemRendererComponent(e,n,t,i);break;case"UnityEngine.LineRenderer":r=this._loadLineRendererComponent(e,n,t,i);break;case"UnityEngine.CanvasRenderer":r=this._loadCanvasRendererComponent(e,n,t,i);break;case"UnityEngine.TrailRenderer":r=this._loadTrailRendererComponent(e,n,t,i);break;case"UnityEngine.ReflectionProbe":r=this._loadReflectionProbeComponent(e,n,t,i);break;case"UnityEngine.SpringJoint":case"UnityEngine.FixedJoint":case"UnityEngine.HingeJoint":case"UnityEngine.CharacterJoint":case"UnityEngine.ConfigurableJoint":r=this._loadJointComponent(e,n,t,i)}return r&&i.Put(t.id,r),r},_loadTransformComponent:function(e,n,t,r){var a=t.data;return n.setLocalPosition(a[i.position+0],a[i.position+1],a[i.position+2]),n.setLocalRotation(a[i.rotation+0],a[i.rotation+1],a[i.rotation+2],a[i.rotation+3]),n.setLocalScale(a[i.scale+0],a[i.scale+1],a[i.scale+2]),n["__UnityEngine.Transform"]=new UnityEngine.Transform(n),n},_loadAnimatorComponent:function(e,n,t,i){var a=t.data,o=new pc.AnimatorComponent;n.addUnityComponentFromDeserialization("animator",o),o._entity=n;var s=new UnityEngine.Animator(o);o._enabled=!!a[r.enabled],s.animatorController=i.TryGet(a[r.animatorController+1]),s.updateMode=a[r.updateMode],o.code=s;for(var l=a[r.humanBones],c=o.code.humanBones,d=0;d<l.length;d+=2)e.r(l[d+0],l[d+1],2,c);return o},_loadAnimationComponent:function(e,n,t,i){for(var r=t.data,o=new(System.Collections.Generic.List$1(UnityEngine.AnimationClip).ctor),s=r[a.clips],l=0;l<s.length;l+=2){var c=i.Get(s[l+1]);o.add(c)}var d=new pc.AnimationComponent;d._enabled=!!r[a.enabled],d._entity=n,n.addUnityComponentFromDeserialization("animation",d);var u=d["__UnityEngine.Animation"];return u.playAutomatically=r[a.playAutomatically],u.clip=i.TryGet(r[a.clip+1]),u.clips=o,d.code=u,d},_loadCanvasComponent:function(e,n,t,i){var r=pc.MonoBehaviourComponent.create({type:Deserializers.types[t.type],enabled:t.data[o.enabled],entity:n});return r.code.ConfigureForEntity(n),n.screen.$id=t.id,n.addUnityComponentFromDeserialization("monoBehaviour",r),n.screen.monoComponent=r,r.code.enabled=t.data[o.enabled],r.code.internalExecutionOrder=0,e.deserializeTo(t.data,r.code,"Luna.Unity.DTO.UnityEngine.Components.Canvas"),r},_loadCanvasGroupComponent:function(e,n,t,i){var r=pc.MonoBehaviourComponent.create({type:Deserializers.types[t.type],enabled:t.data[s.enabled],entity:n});return r.code.code=r.code,e.deserializeTo(t.data,r.code,"Luna.Unity.DTO.UnityEngine.Components.CanvasGroup"),n.addUnityComponentFromDeserialization("monoBehaviour",r),r},_loadUIBehaviourComponent:function(e,n,t,i){var r=Deserializers.types[t.class],a=pc.MonoBehaviourComponent.create({type:r,enabled:t.enabled,entity:n});return a?(a.code.ConfigureForEntity(n),e.deserializeTo(t.data,a.code),n.addUnityComponentFromDeserialization("monoBehaviour",a),a):null},_loadTextMesh:function(e,n,t,i){var r=pc.MonoBehaviourComponent.create({type:Deserializers.types[t.type],enabled:!0,entity:n});return r?(r.code.ConfigureForEntity(n),e.deserializeTo(t.data,r.code,"Luna.Unity.DTO.UnityEngine.Components.TextMesh"),n.addUnityComponentFromDeserialization("monoBehaviour",r),r):null},_loadRectTransformComponent:function(e,n,t,i){var r=t.data;return n.addComponent("element",{type:pc.ELEMENTTYPE_GROUP,pivot:new pc.Vec2(r[l.pivot+0],r[l.pivot+1]),anchor:new pc.Vec4(r[l.anchorMin+0],r[l.anchorMin+1],r[l.anchorMax+0],r[l.anchorMax+1]),sizeDelta:new pc.Vec2(r[l.sizeDelta+0],r[l.sizeDelta+1]),anchoredPosition:new pc.Vec2(r[l.anchoredPosition3D+0],r[l.anchoredPosition3D+1])}),n.element._width=n.element.sizeDelta.x,n.element._height=n.element.sizeDelta.y,n.localPosition.z=r[l.anchoredPosition3D+2],n.setLocalRotation(r[l.rotation+0],r[l.rotation+1],r[l.rotation+2],r[l.rotation+3]),n.setLocalScale(r[l.scale+0],r[l.scale+1],r[l.scale+2]),n["__UnityEngine.Transform"]=new UnityEngine.RectTransform(n),n["__UnityEngine.RectTransform"]=new UnityEngine.RectTransform(n),n},_loadCameraComponent:function(e,n,t,i){var r=t.data,a=r[c.rect];if(n.addComponent("camera",{clearColor:new pc.Color(r[c.backgroundColor+0],r[c.backgroundColor+1],r[c.backgroundColor+2],r[c.backgroundColor+3]),aspectRatio:this.graphicsDevice.width/this.graphicsDevice.height,fov:r[c.fieldOfView],nearClip:r[c.nearClipPlane],farClip:r[c.farClipPlane],clearColorBuffer:r[c.clearFlags]<=UnityEngine.CameraClearFlags.Color,clearDepthBuffer:r[c.clearFlags]<=UnityEngine.CameraClearFlags.Depth,clearStencilBuffer:r[c.clearFlags]<=UnityEngine.CameraClearFlags.Color,clearSkybox:r[c.clearFlags]===UnityEngine.CameraClearFlags.Skybox,projection:r[c.orthographic]?pc.PROJECTION_ORTHOGRAPHIC:pc.PROJECTION_PERSPECTIVE,orthoHeight:r[c.orthographicSize],priority:r[c.depth],cullingMask:r[c.cullingMask],rect:new pc.Vec4(a[0],a[1],a[2],a[3]),frustumCulling:!0}),!n.$prefab&&r[c.targetTexture+1]){var o=UnityEngine.Object.FromHandle(UnityEngine.RenderTexture,this.registry.Get(r[c.targetTexture+1]));if(o){UnityEngine.Object.FromHandle(UnityEngine.Camera,n.camera).targetTexture=o,n.camera.aspectRatio=1*o.handle.width/o.handle.height}}return n.camera},_loadVideoPlayerComponent:function(e,n,t,i){var r=t.data,a=new pc.VideoPlayerComponent({enabled:!!r[d.enabled],entity:n}),o=new UnityEngine.Video.VideoPlayer(a);return o.ConfigureForEntity(n),a.code=o,e.deserializeTo(r,o,"Luna.Unity.DTO.UnityEngine.Components.VideoPlayer"),n.addUnityComponentFromDeserialization("videoPlayer",a),a},_loadAudioSourceComponent:function(e,n,t,i){var r=t.data,a=new pc.AudioSourceUnityComponent({id:t.id,loop:r[u.loop],sound:i.TryGet(r[u.clip+1]),playOnAwake:r[u.playOnAwake]});return n.addUnityComponentFromDeserialization("audiosourceunity",a),a.enabled=!!r[u.enabled],a},_loadLightComponent:function(e,n,t,i){var r=t.data;return n.addComponent("light",{type:["spot","directional","point",null][r[y.type]],color:new pc.Color(r[y.color+0],r[y.color+1],r[y.color+2],r[y.color+3]),intensity:r[y.intensity],innerConeAngle:0,outerConeAngle:r[y.spotAngle],range:r[y.range],cullingMask:r[y.cullingMask],castShadows:r[y.shadows]!=UnityEngine.LightShadows.None,shadowDistance:50,shadowResolution:2048,shadowBias:r[y.shadowBias],shadowType:pc.SHADOW_VSM32,falloffMode:pc.LIGHTFALLOFF_INVERSESQUARED,affectDynamic:r[y.lightmapBakeType]!=UnityEngine.LightmapBakeType.Baked,affectLightmapped:r[y.lightmapBakeType]<=UnityEngine.LightmapBakeType.Baked,enabled:!!r[y.enabled],renderMode:r[y.renderMode],cookie:i.TryGet(r[y.cookie+1]),cookieScale:new pc.Vec2(r[y.cookieSize],r[y.cookieSize])}),n.light},_loadMeshFilterComponent:function(e,n,t,i){var r=t.data,a=new pc.MeshFilterComponent;return n.addUnityComponentFromDeserialization("meshFilter",a),a.id=t.id,a.mesh=i.TryGet(r[p.sharedMesh+1]),a},_loadMeshRendererComponent:function(e,n,t,i){var r=t.data,a=this._loadRendererComponent(g,new pc.MeshRendererComponent,e,n,t,i),o=a.code;return o.lightProbeUsage=r[g.lightProbeUsage],o.reflectionProbeUsage=r[g.reflectionProbeUsage],a},_loadSkinnedMeshRendererComponent:function(e,n,t,i){var r=t.data,a=i.TryGet(r[h.sharedMesh+1]);if(null!=a){var o=this._loadRendererComponent(h,new pc.SkinnedMeshRendererComponent,e,n,t,i),s=o.model;s.mesh=a;var l=o.code;l.lightProbeUsage=r[h.lightProbeUsage],l.reflectionProbeUsage=r[h.reflectionProbeUsage];var c=r[h.bones];if(0!=c.length){for(var d=new Array(c.length/2),u=new Array(0),y=0;y<c.length;y+=2)e.r(!0,c[y+1],2,u),d.push(c[y+1]);o.model.bones=u,o.model.skin=new pc.Skin(this.graphicsDevice,a.bindposes,d),o.__renderer="skinned-mesh";var p=r[h.localBounds];o.model.skin.localBounds=new pc.BoundingBox(new pc.Vec3(p[0],p[1],p[2]),new pc.Vec3(p[3],p[4],p[5])),o.model.skin.updateWhenOffscreen=!!r[h.updateWhenOffscreen],e.r(!0,r[h.rootBone+1],0,o.model.skin,"rootBone")}var g=r[h.blendShapesWeights];if(0!=g.length){var m=new pc.MorphInstance(a.morph);m._setBaseMesh(a);for(y=0;y<g.length;y++)m.setWeight(y,g[y][0]);s.morphInstance=m}return o}console.log("Missing mesh on skinned mesh. GameObject : "+n.name)},_loadSpriteRendererComponent:function(e,n,t,i){var r=t.data,a=this._loadRendererComponent(m,new pc.SpriteRendererComponent,e,n,t,i),o=a.code,s=i.TryGet(r[m.sprite+1]);return o.sortingLayerIndex=UnityEngine.SortingLayer.GetLayerValueFromID(r[m.sortingLayerID]),o.sortingOrder=r[m.sortingOrder],o.color=new pc.Color(r[m.color+0],r[m.color+1],r[m.color+2],r[m.color+3]),o.flipX=r[m.flipX],o.flipY=r[m.flipY],s&&(o.sprite=UnityEngine.Object.FromHandle(UnityEngine.Sprite,s)),a.__renderer="sprite",a},_loadRigidbodyComponent:function(e,n,t,i){var r=t.data,a=new pc.RigidbodyComponent({enabled:!0,maxAngularVelocity:r[f.maxAngularVelocity],mass:r[f.mass],drag:r[f.drag],angularDrag:r[f.angularDrag],useGravity:!!r[f.useGravity],isKinematic:!!r[f.isKinematic],constraints:r[f.constraints],collisionDetectionMode:r[f.collisionDetectionMode],interpolation:r[f.interpolation]});return n.addUnityComponentFromDeserialization("rigidbody",a),a},_loadBoxColliderComponent:function(e,n,t,i){var r=t.data,a=new pc.BoxColliderComponent({enabled:r[C.enabled],size:new pc.Vec3(r[C.size+0],r[C.size+1],r[C.size+2]),material:i.TryGet(r[C.material+1]),center:new pc.Vec3(r[C.center+0],r[C.center+1],r[C.center+2]),isTrigger:!!r[C.isTrigger]});return n.addUnityComponentFromDeserialization("collider",a),a},_loadSphereColliderComponent:function(e,n,t,i){var r=t.data,a=new pc.SphereColliderComponent({enabled:r[b.enabled],radius:r[b.radius],material:i.TryGet(r[b.material+1]),center:new pc.Vec3(r[b.center+0],r[b.center+1],r[b.center+2]),isTrigger:!!r[b.isTrigger]});return n.addUnityComponentFromDeserialization("collider",a),a},_loadMeshColliderComponent:function(e,n,t,i){var r=t.data,a=new pc.MeshColliderComponent({enabled:r[_.enabled],mesh:i.TryGet(r[_.sharedMesh+1]),material:i.TryGet(r[_.material+1]),isTrigger:!!r[_.isTrigger],convex:!!r[_.convex]});return n.addUnityComponentFromDeserialization("collider",a),a},_loadCapsuleColliderComponent:function(e,n,t,i){var r=t.data,a=new pc.CapsuleColliderComponent({enabled:r[T.enabled],radius:r[T.radius],material:i.TryGet(r[T.material+1]),center:new pc.Vec3(r[T.center+0],r[T.center+1],r[T.center+2]),height:r[T.height],direction:r[T.direction],isTrigger:!!r[T.isTrigger]});return n.addUnityComponentFromDeserialization("collider",a),a},_loadWheelColliderComponent:function(e,n,t,i){const r=new pc.WheelColliderComponent,a=UnityEngine.Object.FromHandle(Bridge._getTypeByName(Deserializers.types[t.type]),r);return e.deserializeTo(t.data,a,"Luna.Unity.DTO.UnityEngine.Components.WheelCollider"),n.addUnityComponentFromDeserialization("collider",r),r},_loadCharacterControllerComponent:function(e,n,t,i){const r=new pc.CharacterControllerComponent,a=UnityEngine.Object.FromHandle(Bridge._getTypeByName(Deserializers.types[t.type]),r);return e.deserializeTo(t.data,a,"Luna.Unity.DTO.UnityEngine.Components.CharacterController"),n.addUnityComponentFromDeserialization("collider",r),r},_loadRigidbody2DComponent:function(e,n,t,i){var r=t.data,a=new pc.Rigidbody2DComponent({enabled:!0,simulated:r[U.simulated],useAutoMass:r[U.useAutoMass],type:r[U.bodyType],mass:r[U.mass],drag:r[U.drag],angularDrag:r[U.angularDrag],gravityScale:r[U.gravityScale],collisionDetectionMode:r[U.collisionDetectionMode],constraints:r[U.constraints],material:i.TryGet(U.material+1)});return n.addUnityComponentFromDeserialization("rigidbody2D",a),a},_loadBoxCollider2DComponent:function(e,n,t,i){var r=t.data,a=new pc.BoxCollider2DComponent({enabled:r[A.enabled],isTrigger:r[A.isTrigger],density:r[A.density],size:new pc.Vec2(r[A.size+0],r[A.size+1]),center:new pc.Vec2(r[A.offset+0],r[A.offset+1]),radius:r[A.edgeRadius],material:i.TryGet(r[A.material+1])});return n.addUnityComponentFromDeserialization("collider2D",a),a},_loadCircleCollider2DComponent:function(e,n,t,i){var r=t.data,a=new pc.CircleCollider2DComponent({enabled:r[E.enabled],isTrigger:r[E.isTrigger],density:r[E.density],radius:r[E.radius],center:new pc.Vec2(r[E.offset+0],r[E.offset+1]),material:i.TryGet(r[E.material+1])});return n.addUnityComponentFromDeserialization("collider2D",a),a},_loadCapsuleCollider2DComponent:function(e,n,t,i){var r=t.data,a=new pc.CapsuleCollider2DComponent({enabled:r[D.enabled],isTrigger:r[D.isTrigger],density:r[D.density],center:new pc.Vec2(r[D.offset+0],r[D.offset+1]),material:i.TryGet(r[D.material+1]),direction:r[D.direction],size:new pc.Vec2(r[D.size+0],r[D.size+1])});return n.addUnityComponentFromDeserialization("collider2D",a),a},_loadEdgeCollider2DComponent:function(e,n,t,i){var r=t.data,a=new pc.EdgeCollider2DComponent({enabled:r[R.enabled],isTrigger:r[R.isTrigger],density:r[R.density],points:r[R.points],offset:new pc.Vec2(r[R.offset+0],r[R.offset+1]),radius:r[R.edgeRadius],material:i.TryGet(r[R.material+1])});return n.addUnityComponentFromDeserialization("collider2D",a),a},_loadPolygonCollider2DComponent:function(e,n,t,i){var r=t.data,a=new pc.PolygonCollider2DComponent({enabled:r[O.enabled],isTrigger:r[O.isTrigger],density:r[O.density],points:r[O.points],offset:new pc.Vec2(r[O.offset+0],r[O.offset+1]),material:i.TryGet(r[O.material+1])});return n.addUnityComponentFromDeserialization("collider2D",a),a},_loadSpringJoint2DComponent:function(e,n,t,i){var r=t.data;return this._loadJoint2DComponent(e,n,t,L,new pc.SpringJoint2DComponent({enabled:r[L.enabled],enableCollision:r[L.enableCollision],breakForce:r[L.breakForce],breakTorque:r[L.breakTorque],frequency:r[L.frequency],dampingRatio:r[L.dampingRatio],distance:r[L.distance],autoConfigureConnectedAnchor:r[L.autoConfigureConnectedAnchor],anchor:new pc.Vec2(r[L.anchor+0],r[L.anchor+1]),connectedAnchor:new pc.Vec2(r[L.connectedAnchor+0],r[L.connectedAnchor+1])}))},_loadDistanceJoint2DComponent:function(e,n,t,i){var r=t.data;return this._loadJoint2DComponent(e,n,t,v,new pc.DistanceJoint2DComponent({enabled:r[v.enabled],enableCollision:r[v.enableCollision],breakForce:r[v.breakForce],breakTorque:r[v.breakTorque],maxDistanceOnly:r[v.maxDistanceOnly],distance:r[v.distance],autoConfigureDistance:r[v.autoConfigureDistance],autoConfigureConnectedAnchor:r[v.autoConfigureConnectedAnchor],anchor:new pc.Vec2(r[v.anchor+0],r[v.anchor+1]),connectedAnchor:new pc.Vec2(r[v.connectedAnchor+0],r[v.connectedAnchor+1])}))},_loadFixedJoint2DComponent:function(e,n,t,i){var r=t.data;return this._loadJoint2DComponent(e,n,t,w,new pc.FixedJoint2DComponent({enabled:r[w.enabled],enableCollision:r[w.enableCollision],breakForce:r[w.breakForce],breakTorque:r[w.breakTorque],frequency:r[w.frequency],dampingRatio:r[w.dampingRatio],autoConfigureConnectedAnchor:r[w.autoConfigureConnectedAnchor],anchor:new pc.Vec2(r[w.anchor+0],r[w.anchor+1]),connectedAnchor:new pc.Vec2(r[w.connectedAnchor+0],r[w.connectedAnchor+1])}))},_loadHingeJoint2DComponent:function(e,n,t,i){var r=t.data,a=new UnityEngine.JointAngleLimits2D;e.deserializeTo(r[S.limits],a);var o=new UnityEngine.JointMotor2D;return e.deserializeTo(r[S.motor],o),this._loadJoint2DComponent(e,n,t,S,new pc.HingeJoint2DComponent({enabled:r[S.enabled],enableCollision:r[S.enableCollision],breakForce:r[S.breakForce],breakTorque:r[S.breakTorque],autoConfigureConnectedAnchor:r[S.autoConfigureConnectedAnchor],anchor:new pc.Vec2(r[S.anchor+0],r[S.anchor+1]),connectedAnchor:new pc.Vec2(r[S.connectedAnchor+0],r[S.connectedAnchor+1]),useLimits:r[S.useLimits],limits:a,useMotor:r[S.useMotor],motor:o}))},_loadWheelJoint2DComponent:function(e,n,t,i){var r=t.data,a=new UnityEngine.JointSuspension2D;e.deserializeTo(r[F.suspension],a);var o=new UnityEngine.JointMotor2D;return e.deserializeTo(r[F.motor],o),this._loadJoint2DComponent(e,n,t,F,new pc.WheelJoint2DComponent({enabled:r[F.enabled],enableCollision:r[F.enableCollision],breakForce:r[F.breakForce],breakTorque:r[F.breakTorque],autoConfigureConnectedAnchor:r[F.autoConfigureConnectedAnchor],anchor:new pc.Vec2(r[F.anchor+0],r[F.anchor+1]),connectedAnchor:new pc.Vec2(r[F.connectedAnchor+0],r[F.connectedAnchor+1]),suspension:a,useMotor:r[F.useMotor],motor:o}))},_loadFrictionJoint2DComponent:function(e,n,t,i){var r=t.data;return this._loadJoint2DComponent(e,n,t,P,new pc.FrictionJoint2DComponent({enabled:r[P.enabled],enableCollision:r[P.enableCollision],breakForce:r[P.breakForce],breakTorque:r[P.breakTorque],autoConfigureConnectedAnchor:r[P.autoConfigureConnectedAnchor],anchor:new pc.Vec2(r[P.anchor+0],r[P.anchor+1]),connectedAnchor:new pc.Vec2(r[P.connectedAnchor+0],r[P.connectedAnchor+1]),maxForce:r[P.maxForce],maxTorque:r[P.maxTorque]}))},_loadRelativeJoint2DComponent:function(e,n,t,i){var r=t.data;return this._loadJoint2DComponent(e,n,t,B,new pc.RelativeJoint2DComponent({enabled:r[B.enabled],enableCollision:r[B.enableCollision],breakForce:r[B.breakForce],breakTorque:r[B.breakTorque],autoConfigureOffset:r[B.autoConfigureOffset],linearOffset:new pc.Vec2(r[B.linearOffset+0],r[B.linearOffset+1]),angularOffset:r[B.angularOffset],maxForce:r[B.maxForce],maxTorque:r[B.maxTorque],correctionScale:r[B.correctionScale]}))},_loadSliderJoint2DComponent:function(e,n,t,i){var r=t.data,a=new UnityEngine.JointTranslationLimits2D;e.deserializeTo(r[M.limits],a);var o=new UnityEngine.JointMotor2D;return e.deserializeTo(r[M.motor],o),this._loadJoint2DComponent(e,n,t,M,new pc.SliderJoint2DComponent({enabled:r[M.enabled],enableCollision:r[M.enableCollision],breakForce:r[M.breakForce],breakTorque:r[M.breakTorque],autoConfigureConnectedAnchor:r[M.autoConfigureConnectedAnchor],anchor:new pc.Vec2(r[M.anchor+0],r[M.anchor+1]),connectedAnchor:new pc.Vec2(r[M.connectedAnchor+0],r[M.connectedAnchor+1]),autoConfigureAngle:r[M.autoConfigureAngle],angle:r[M.angle],useLimits:r[M.useLimits],limits:a,useMotor:r[M.useMotor],motor:o}))},_loadTargetJoint2DComponent:function(e,n,t,i){var r=t.data;return this._loadJoint2DComponent(e,n,t,I,new pc.TargetJoint2DComponent({enabled:r[I.enabled],enableCollision:r[I.enableCollision],breakForce:r[I.breakForce],breakTorque:r[I.breakTorque],autoConfigureTarget:r[I.autoConfigureTarget],target:new pc.Vec2(r[I.target+0],r[I.target+1]),anchor:new pc.Vec2(r[I.anchor+0],r[I.anchor+1]),maxForce:r[I.maxForce],dampingRatio:r[I.dampingRatio],frequency:r[I.frequency]}))},_loadJoint2DComponent:function(e,n,t,i,r){var a=t.data,o=Deserializers.types[t.type],s=UnityEngine.Object.FromHandle(Bridge._getTypeByName(o),r);return e.r(a[i.connectedBody+0],a[i.connectedBody+1],0,s,"connectedBody"),n.addUnityComponentFromDeserialization("joint2D",r),r},_loadParticleSystemComponent:function(e,n,t,i){var r=new pc.ParticleSystem,a=new pc.ParticleSystemComponent({particleSystem:r});return e.deserializeTo(t.data,r,"Luna.Unity.DTO.UnityEngine.Components.ParticleSystem"),n.addUnityComponentFromDeserialization("particlesystem",a),a},_loadParticleSystemRendererComponent:function(e,n,t,i){var r=new pc.ParticleSystemRenderer;e.deserializeTo(t.data,r,"Luna.Unity.DTO.UnityEngine.Components.ParticleSystemRenderer"),r.sortingLayerIndex=UnityEngine.SortingLayer.GetLayerValueFromID(r.sortingLayerID),r.sortingOrder=r.sortingOrder;var a=new pc.ParticleSystemRendererComponent({particleSystemRenderer:r});return n.addUnityComponentFromDeserialization("particleSystemRenderer",a),a.enabled=r.enabled,a},_loadJointComponent:function(e,n,t,i){var r=t.data,a=new pc.JointComponent({type:Deserializers.types[t.type]}),o=UnityEngine.Object.FromHandle(Bridge._getTypeByName(Deserializers.types[t.type]),a);return e.deserializeTo(r,o,Deserializers.types[t.type].replace("UnityEngine.","Luna.Unity.DTO.UnityEngine.Components.")),n.addUnityComponentFromDeserialization("joint",a),a},_loadMonoBehaviourComponent:function(e,n,t,i){var r=Deserializers.types[t.class],a=pc.MonoBehaviourComponent.create({type:r,enabled:t.enabled,entity:n});return a?(e.deserializeTo(t.data,a.code),n.addUnityComponentFromDeserialization("monoBehaviour",a),a):null},_loadRendererComponent:function(e,n,t,i,r,a){var o=r.data;const s=n;i.addUnityComponentFromDeserialization("renderer",s);for(var l=o[e.sharedMaterials],c=[],d=0;d<l.length;d+=2){var u=a.TryGet(l[d+1]);c.push(u)}return s.model.materials=c,s.model.sortingLayerIndex=UnityEngine.SortingLayer.GetLayerValueFromID(o[e.sortingLayerID]),s.model.sortingOrder=o[e.sortingOrder],s.model.cullingLayer=i.cullingLayer,s.enabled=!!o[e.enabled],s.castShadows=o[e.shadowCastingMode]>UnityEngine.Rendering.ShadowCastingMode.Off,s.receiveShadows=!!o[e.receiveShadows],s.id=r.id,s.model._lightmapSceneIndex=o[e.lightmapSceneIndex],s.model._lightmapIndex=o[e.lightmapIndex],s.model.lightmapScaleOffset=new pc.Vec4(o[e.lightmapScaleOffset+0],o[e.lightmapScaleOffset+1],o[e.lightmapScaleOffset+2],o[e.lightmapScaleOffset+3]),s},_loadLineRendererComponent:function(e,n,t,i){t.data;var r=this._loadRendererComponent(x,new pc.LineRendererComponent,e,n,t,i),a=r.code;return e.deserializeTo(t.data,a,"Luna.Unity.DTO.UnityEngine.Components.LineRenderer"),r},_loadCanvasRendererComponent:function(e,n,t,i){var r=new pc.CanvasRendererComponent;return e.deserializeTo(t.data,r.code,"Luna.Unity.DTO.UnityEngine.Components.CanvasRenderer"),n.addUnityComponentFromDeserialization("canvasRenderer",r),r},_loadTrailRendererComponent:function(e,n,t,i){t.data;var r=this._loadRendererComponent(k,new pc.TrailRendererComponent,e,n,t,i),a=r.code;return e.deserializeTo(t.data,a,"Luna.Unity.DTO.UnityEngine.Components.TrailRenderer"),r},_loadReflectionProbeComponent:function(e,n,t,i){var r=t.data,a=new pc.ReflectionProbeComponent,o=UnityEngine.Object.FromHandle(UnityEngine.ReflectionProbe,a);return e.deserializeTo(r,o,"Luna.Unity.DTO.UnityEngine.Components.ReflectionProbe"),n.addUnityComponentFromDeserialization("reflectionprobe",a),a}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";Bridge.define("LunaUnity.Objects.Handlers.AudioMixer",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n,t){n.data;var i=e.d("Luna.Unity.DTO.UnityEngine.Audio.AudioMixer",n.data),r=new UnityEditor.Audio.AudioMixerController(i);this.registry.Put(n.id,r);for(var a=0;a<r.groups.length;a++)this.registry.Put(r.groups[a].id,r.groups[a]);return{result:r}},unloadAsync:function(e){this.registry.Release(e.id)}})})),Bridge.assembly("LunaUnity",(function(e,n){Bridge.define("LunaUnity.Objects.Handlers.AudioMixerSnapshot",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n,t){var i=e.d("Luna.Unity.DTO.UnityEngine.Audio.AudioMixerSnapshot",n.data),r=new UnityEngine.Audio.AudioMixerSnapshot(i);return this.registry.Put(n.id,r),{result:r}},unloadAsync:function(e){this.registry.Release(e.id)}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";var t=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings"],i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+ScriptsExecutionOrder"],r=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+SortingLayer"],a=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+CullingLayer"],o=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+TimeSettings"],s=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+PhysicsSettings"],l=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+PhysicsSettings+CollisionMask"],c=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.ProjectSettings+Physics2DSettings"];Bridge.define("LunaUnity.Objects.Handlers.ProjectSettings",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n,d){for(var u=n.data,y=u[t.scriptsExecutionOrder],p=[],g=0;g<y.length;g++){var h=y[g];p[h[i.name]]=h[i.value]}this.app.systems.monoBehaviour.scriptsExecutionOrder=p;var m=u[t.sortingLayers];pc.Application.getApplication().renderer.removeShadows=!!u[t.removeShadows],this.autoInstantiatePrefabs=!!u[t.autoInstantiatePrefabs];for(g=0;g<m.length;g++){var f=new UnityEngine.SortingLayer,C=m[g];f.id=C[r.id],f.name=C[r.name],f.value=C[r.value],UnityEngine.SortingLayer.layers.push(f)}var b=u[t.cullingLayers];for(g=0;g<b.length;g++){f=new UnityEngine.LayerMask.CullingLayer;var _=b[g];f.id=_[a.id],f.name=_[a.name],UnityEngine.LayerMask.layers.push(f)}var T=u[t.timeSettings];this.app.systems.unitymanager.fixedTimeStep=T[o.fixedDeltaTime],this.app.systems.unitymanager.maximumAllowedTimeStep=T[o.maximumDeltaTime],this.app.systems.unitymanager.timeScale=T[o.timeScale],this.app.systems.unitymanager.maximumParticleTimestep=T[o.maximumParticleTimestep];var U=u[t.physicsSettings];this.app.systems.physics.gravity=new pc.Vec3(U[s.gravity+0],U[s.gravity+1],U[s.gravity+2]);var A=U[s.collisionMatrix];for(g=0;g<A.length;g++){var E=A[g];this.app.systems.physics.setIgnoreCollisionBetweenLayers(E[l.layerId],E[l.otherLayerId],E[l.enabled])}this.app.systems.physics.defaultSolverIterations=U[s.defaultSolverIterations],this.app.systems.physics.autoSyncTransforms=!!U[s.autoSyncTransforms],this.app.systems.physics.autoSimulation=!!U[s.autoSimulation];var D=this.app.systems.physics2D,R=u[t.physics2DSettings];D.gravity=new pc.Vec2(R[c.gravity+0],R[c.gravity+1]),D.autoSyncTransforms=R[c.autoSyncTransforms],D.positionIterations=R[c.positionIterations],D.velocityIterations=R[c.velocityIterations],e.r(!0,R[c.material+1],0,D,"defaultMaterial");var O=R[c.collisionMatrix];for(g=0;g<O.length;g++){E=O[g];D.setIgnoreCollisionBetweenLayers(E[l.layerId],E[l.otherLayerId],E[l.enabled])}return UnityEngine.Graphics.graphicsDevice.enableAutoInstancing=!!u[t.enableAutoInstancing],UnityEngine.LightmapSettings.lightmapEncodingQuality=u[t.lightmapEncodingQuality],UnityEngine.LightmapSettings.bakedColorSpace=u[t.desiredColorSpace],{}},unloadAsync:function(e){this.registry.Release(e.id)}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";var t=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.Material"];Bridge.define("LunaUnity.Objects.Handlers.Material",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e),this.request=new LunaUnity.Objects.ImmediateRequest(null)},loadAsync:function(e,n,i){this.request.registry=this.registry;var r=this.request.d("Luna.Unity.DTO.UnityEngine.Assets.Material",n.data);return r.shader=this.registry.TryGet(n.data[t.shader+1]),r.setup(),"Default UI Material"===r.name&&(UnityEngine.Canvas.DefaultCanvasMaterial=UnityEngine.Object.FromHandle(UnityEngine.Material,r)),"Sprites-Default"===r.name&&(UnityEngine.Material.SpritesDefault=UnityEngine.Object.FromHandle(UnityEngine.Material,r)),"Font Material"===r.name&&(UnityEngine.Material.FontDefault=UnityEngine.Object.FromHandle(UnityEngine.Material,r)),this.registry.Put(n.id,r),System.Threading.Tasks.Task.fromResult(r)},unloadAsync:function(e){this.registry.Release(e.id)}})})),Bridge.assembly("LunaUnity",(function(e,n){Bridge.define("LunaUnity.Objects.Handlers.PhysicMaterial",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n){var t=e.d("Luna.Unity.DTO.UnityEngine.Assets.PhysicMaterial",n.data),i=new Goblin.PhysicMaterial(t);return this.registry.Put(n.id,i),{result:i}},unloadAsync:function(e){this.registry.Release(e.id)}})})),Bridge.assembly("LunaUnity",(function(e,n){Bridge.define("LunaUnity.Objects.Handlers.PhysicsMaterial2D",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n){var t=e.d("Luna.Unity.DTO.UnityEngine.Assets.PhysicsMaterial2D",n.data);return this.registry.Put(n.id,t),{result:t}},unloadAsync:function(e){this.registry.Release(e.id)}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";var t=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.Mesh"],i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.Mesh+SubMesh"],r=new Blob;Bridge.define("LunaUnity.Objects.Handlers.Mesh",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n,a){var o=n.data,s=new pc.Mesh(!0),l=a.find((function(e){return e.manifest.id===n.assetBundleId})).blob||r;s.name=o[t.name];var c,d,u=o[t.vertices],y=l.slice(u[0],u[0]+u[1]);c=o[t.halfPrecision]?pc.Conversion.fromFloat16ToFloat32(new Uint16Array(y)):new Float32Array(y),d=s.defaultVertexBuffer(o[t.streams],o[t.vertexCount],c.buffer),o[t.vertices]=null,s.vertexBuffer=d,s.subMeshes=[];for(var p=o[t.subMeshes],g=o[t.aabb],h=0;h<p.length;h++){var m=p[h][i.triangles],f=new Int16Array(l.slice(m[0],m[0]+m[1])),C=new pc.Mesh;C.aabb=new pc.BoundingBox(new pc.Vec3(g[0],g[1],g[2]),new pc.Vec3(g[3],g[4],g[5])),C.$id=n.id;var b=s.defaultIndexBuffer(f.length,f);C.vertexBuffer=d,C.indexBuffer[0]=b,C.primitive[0].type=pc.gfx.PRIMITIVE_TRIANGLES,C.primitive[0].base=0,C.primitive[0].count=f.length,C.primitive[0].indexed=!0,s.subMeshes.push(C)}s.indexBuffer=s.subMeshes[0].indexBuffer,s.primitive[0].type=pc.gfx.PRIMITIVE_TRIANGLES,s.primitive[0].base=0,s.primitive[0].count=p[0].length,s.primitive[0].indexed=!0,s.aabb=new pc.BoundingBox(new pc.Vec3(g[0],g[1],g[2]),new pc.Vec3(g[3],g[4],g[5]));var _=o[t.bindposes];for(h=0;h<_.length;h+=16)s.bindposes.push((new pc.Mat4).setData(_[h+0],_[h+1],_[h+2],_[h+3],_[h+4],_[h+5],_[h+6],_[h+7],_[h+8],_[h+9],_[h+10],_[h+11],_[h+12],_[h+13],_[h+14],_[h+15]));var T=o[t.blendShapes];if(0!=T.length){s.morph=new pc.Morph([]);for(h=0;h<T.length;h++){var U=T[h],A=U[1],E={};E.name=U[0],E.frames=[];for(var D=0;D<A.length;D++){var R={};R.weight=U[1][D][0],y=l.slice(U[1][D][1][0],U[1][D][1][0]+U[1][D][1][1]),R.deltaPositions=o[t.halfPrecision]?pc.Conversion.fromFloat16ToFloat32(new Uint16Array(y)):U[1][D][1],y=l.slice(U[1][D][2][0],U[1][D][2][0]+U[1][D][2][1]),R.deltaNormals=o[t.halfPrecision]?pc.Conversion.fromFloat16ToFloat32(new Uint16Array(y)):U[1][D][2],y=l.slice(U[1][D][3][0],U[1][D][3][0]+U[1][D][3][1]),R.deltaTangents=o[t.halfPrecision]?pc.Conversion.fromFloat16ToFloat32(new Uint16Array(y)):U[1][D][3];var O=new pc.MorphTargetFrame(R);E.frames[D]=O}var L=new pc.MorphTarget(E);s.morph.addTarget(L),s.morph._setBaseMesh(s)}}return this.registry.Put(n.id,s),{result:s}},unloadAsync:function(e){var n=this.registry.Release(e.id);n&&n.destroy()}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";var t=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Scene.Scene"],i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.RenderSettings"],r=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.RenderSettings+LightProbes"];Bridge.define("LunaUnity.Objects.Handlers.Scene",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n,r){var a=n.data,o=(new LunaUnity.Objects.Scene).initializeAsTemplate({renderSettings:e.d("Luna.Unity.DTO.UnityEngine.Assets.RenderSettings",n.render_settings.data),rootJsons:n.objects,name:a[t.name],index:a[t.index],lightmaps:a[t.lightmaps]}),s=r.find((function(e){return e.manifest.id===n.assetBundleId})).blob,l=n.render_settings.data[i.lightProbes];return this.parseLightProbeData(s,l,o.renderSettings.lightProbes),UnityEngine.SceneManagement.SceneManager.scenes.push(o),this.registry.Put("scenes/"+n.name,o),{result:o}},parseLightProbeData:function(e,n,t){var i=[],a=0,o=this.getTypedArrayFromBlobAndMarker(Float32Array,e,n[r.bakedProbes]);for(a=0;a<o.length;a+=27)i.push(pc.SphericalHarmonicsL2.fromArray(o.subarray(a,a+27)));for(t.bakedProbes=i,i=[],o=this.getTypedArrayFromBlobAndMarker(Float32Array,e,n[r.positions]),a=0;a<o.length;a+=3)i.push(new pc.Vec3(o[a+0],o[a+1],o[a+2]));for(t.positions=i,i=[],o=this.getTypedArrayFromBlobAndMarker(Float32Array,e,n[r.hullRays]),a=0;a<o.length;a+=3)i.push(new pc.Vec3(o[a+0],o[a+1],o[a+2]));for(t.hullRays=i,i=[],o=this.getTypedArrayFromBlobAndMarker(Float32Array,e,n[r.matrices]),a=0;a<o.length;a+=16)i.push(pc.Mat4.fromArray(o.subarray(a,a+16)));t.matrices=i,t.tetrahedra=this.getTypedArrayFromBlobAndMarker(Int16Array,e,n[r.tetrahedra]),t.neighbours=this.getTypedArrayFromBlobAndMarker(Int16Array,e,n[r.neighbours])},getTypedArrayFromBlobAndMarker:function(e,n,t){return new e(n?n.slice(t[0],t[0]+t[1]):0)},unloadAsync:function(e){this.registry.Release(e.id)}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";var t=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.Shader"];Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.Shader+Pass"],Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.Shader+Pass+Blending"],Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.Shader+DefaultParameterValue"];Bridge.define("LunaUnity.Objects.Handlers.Shader",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n,t){var i=new pc.UnityShader(this.graphicsDevice);return e.d("Luna.Unity.DTO.UnityEngine.Assets.Shader",n.data,i),i.setup(),this.registry.Put(n.id,i),UnityEngine.Shader.shaderIndex[i.name]=i,System.Threading.Tasks.Task.fromResult(i)},_loadRenderState:function(e,n){var t=e.d("Luna.Unity.DTO.UnityEngine.Assets.Shader+Pass",n),i=[];return this._collectBoundParameters(t,i),t.boundParameters=i,t},_collectBoundParameters:function(e,n){for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];i&&i.$$fullname&&("Luna.Unity.DTO.UnityEngine.Assets.Shader.Pass+Value"===i.$$fullname&&i.name?n.push(i):this._collectBoundParameters(i,n))}},_getDefaultTextureNamed:function(e){var n=UnityEngine.Texture2D[e+"Texture"];return n?n.handle:null},_loadShaderForStandardMaterialAsync:function(e,n){return this.registry.Put(n.id,{name:n.data[t.name],renderState:this._loadRenderState(e,n.data[t.passes][0])}),System.Threading.Tasks.Task.fromResult(!0)},_loadCustomShaderAsync:function(e,n){for(var i=[],r=pc.MultipassShader,a=n.data,o=a[t.passes],s=0;s<o.length;s++){var l=a[t.vertexPrograms][s],c=a[t.fragmentPrograms][s];l&&c?d=new r(this.graphicsDevice,{attributes:{vertex_position:pc.SEMANTIC_POSITION,vertex_normal:pc.SEMANTIC_NORMAL,vertex_tangent:pc.SEMANTIC_TANGENT,vertex_texCoord0:pc.SEMANTIC_TEXCOORD0,vertex_texCoord1:pc.SEMANTIC_TEXCOORD1,vertex_color:pc.SEMANTIC_COLOR,instancing_translation:pc.SEMANTIC_TEXCOORD7,instancing_rotation:pc.SEMANTIC_BLENDWEIGHT,instancing_scale:pc.SEMANTIC_BLENDINDICES,instancing_color:pc.SEMANTIC_ATTR0,instancing_st:pc.SEMANTIC_ATTR1,_glesVertex:pc.SEMANTIC_POSITION,_glesNormal:pc.SEMANTIC_NORMAL,_glesTangent:pc.SEMANTIC_TANGENT,_glesMultiTexCoord0:pc.SEMANTIC_TEXCOORD0,_glesMultiTexCoord1:pc.SEMANTIC_TEXCOORD1,_glesMultiTexCoord2:pc.SEMANTIC_TEXCOORD2,_glesMultiTexCoord3:pc.SEMANTIC_TEXCOORD3,_glesColor:pc.SEMANTIC_COLOR,in_POSITION0:pc.SEMANTIC_POSITION,in_NORMAL0:pc.SEMANTIC_NORMAL,in_TANGENT0:pc.SEMANTIC_TANGENT,in_TEXCOORD0:pc.SEMANTIC_TEXCOORD0,in_TEXCOORD1:pc.SEMANTIC_TEXCOORD1,in_TEXCOORD2:pc.SEMANTIC_TEXCOORD2,in_TEXCOORD3:pc.SEMANTIC_TEXCOORD3,in_COLOR0:pc.SEMANTIC_COLOR,_patched_POSITION:pc.SEMANTIC_POSITION,_patched_COLOR:pc.SEMANTIC_COLOR,_patched_NORMAL:pc.SEMANTIC_NORMAL,_patched_TANGENT:pc.SEMANTIC_TANGENT,_patched_TEXCOORD0:pc.SEMANTIC_TEXCOORD0,vertex_boneWeights:pc.SEMANTIC_BLENDWEIGHT,vertex_boneIndices:pc.SEMANTIC_BLENDINDICES},vshader:l,fshader:c}):(d=pc._createMissingShader(n.data[t.name],n.id)).name=n.data[t.name],d._supportsKeywords=!0,d.renderState=this._loadRenderState(e,a[t.passes][s]),i.push(d),r=pc.Shader}var d=i[0];return d.shaders=i,d.defaultParameters={},this.registry.Put(n.id,d),UnityEngine.Shader.shaderIndex[n.name]=d,System.Threading.Tasks.Task.fromResult(d)},unloadAsync:function(e){this.registry.Release(e.id)}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";var t=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.VideoClip"];Bridge.define("LunaUnity.Objects.Handlers.Video",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),this.playgroundAssetOverrides=window.playgroundAssetOverrides||{},LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n,i){var r=new System.Threading.Tasks.TaskCompletionSource,a=n.data,o={name:a[t.name],width:a[t.width],height:a[t.height],frameRate:a[t.frameRate],frameCount:a[t.frameCount]},s=new pc.VideoTexture(this.app.graphicsDevice,o);return this.registry.Put(n.id,s),this.network.GetVideoAsync(this._getVideoUrl(n)).continueWith(Bridge.fn.bind(this,(function(e){if(e.status==System.Threading.Tasks.TaskStatus.ranToCompletion){var n=e.result;s.setSource(n),r.setResult(s)}else r.setCanceled()}))),r.task},_getVideoUrl:function(e){return"external"==this.network.resourceConfig.video&&e.id in this.playgroundAssetOverrides?this.playgroundAssetOverrides[e.id]:"assets/bundles/"+e.assetBundleId+"/"+e.id+(e.ext||".mp4")},unloadAsync:function(e){var n=this.registry.Release(e.id);n&&n.destroy()}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";var t=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.AudioClip"];Bridge.define("LunaUnity.Objects.Handlers.Sound",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),this.playgroundAssetOverrides=window.playgroundAssetOverrides||{},LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n,i){var r=new System.Threading.Tasks.TaskCompletionSource,a=new pc.Sound;a.name=n.data[t.name];var o=this._getSoundUrl(n),s=function(e){a.buffer=e,r.setResult(a)},l=function(e){e=e||"Error loading audio url: "+o,console.error(e),r.setCancelled()},c=this.app._audioManager;return this.registry.Put(n.id,a),this.network.GetSoundAsync(this._getSoundUrl(n)).continueWith((function(e){e.status==System.Threading.Tasks.TaskStatus.ranToCompletion?c.context.decodeAudioData(e.result,s,l):l(e.error)})),r.task},_getSoundUrl:function(e){return"external"==this.network.resourceConfig.sound&&e.id in this.playgroundAssetOverrides?this.playgroundAssetOverrides[e.id]:"assets/bundles/"+e.assetBundleId+"/"+e.id+(e.ext||".mp3")},unloadAsync:function(e){var n=this.registry.Release(e.id);n&&(n.buffer=null)}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";var t=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Textures.Sprite"];Bridge.define("LunaUnity.Objects.Handlers.Sprite",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n,i){var r=n.data,a=this.registry.Get(r[t.texture+1]),o=new pc.Sprite({}),s=r[t.textureWidth]/a.width;return o.attributes.transparency=new pc.Vec4((r[t.packedRect+0]-r[t.textureRect+0])*a.width,(r[t.packedRect+1]-r[t.textureRect+1])*a.height,(r[t.textureRect+2]-r[t.packedRect+2])*a.width,(r[t.textureRect+3]-r[t.packedRect+3])*a.height),o.attributes.textureRect=[r[t.packedRect+0]*a.width,r[t.packedRect+1]*a.height,r[t.packedRect+2]*a.width,r[t.packedRect+3]*a.height],o.attributes.graphicsDevice=this.graphicsDevice,o.attributes.texture=a,o.attributes.border=new pc.Vec4(r[t.border+0]*a.width,r[t.border+1]*a.height,r[t.border+2]*a.width,r[t.border+3]*a.height).sub(o.attributes.transparency),o.attributes.bounds=r[t.bounds],o.attributes.pixelsPerUnit=r[t.pixelsPerUnit]/s,o.attributes.aabb=r[t.aabb],o.attributes.vertices=r[t.vertices],o.attributes.triangles=r[t.triangles],o.attributes.nativeSize=new pc.Vec2(r[t.nativeSize],r[t.nativeSize+1]),this.registry.Put(n.id,o),{result:o}},unloadAsync:function(e){var n=this.registry.Release(e.id);n&&n.mesh&&n.mesh.destroy()}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";var t=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Textures.Texture2D"],i=(Deserializers.fields["Luna.Unity.DTO.UnityEngine.Textures.Texture3D"],Deserializers.fields["Luna.Unity.DTO.UnityEngine.Textures.RenderTexture"]),r=[pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_A8,pc.PIXELFORMAT_R4_G4_B4_A4,pc.PIXELFORMAT_R8_G8_B8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R5_G6_B5,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_RGBA32F,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_PVRTC_2BPP_RGBA_1,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8,pc.PIXELFORMAT_R8_G8_B8_A8];Bridge.define("LunaUnity.Objects.Handlers.Texture",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),this.playgroundAssetOverrides=window.playgroundAssetOverrides||{},LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n,t){if(0===n.type)return this._loadTexture2dAsync(n);if(1===n.type)return this._loadTexture3dAsync(n);if(2===n.type)return System.Threading.Tasks.Task.fromResult(!0);if(3===n.type)return this._loadRenderTextureAsync(n);throw new Error("Unknown texture type: "+n.type)},_loadRenderTextureAsync:function(e){var n=new UnityEngine.RenderTexture.Create(e.data[i.width],e.data[i.height],16,0);return this.registry.Put(e.id,n.handle),System.Threading.Tasks.Task.fromResult(n.handle)},_loadTexture3dAsync:function(e){throw new Error("NotImplemented")},_getDummyTexture:function(){if(this._dummyTexture)return this._dummyTexture;this._dummyTexture=new pc.Texture(this.app.graphicsDevice,{width:16,height:16,format:pc.PIXELFORMAT_R8_G8_B8_A8});for(var e=this._dummyTexture.lock(),n=0;n<e.length;n+=3)e[n+0]=255,e[n+1]=0,e[n+2]=255,e[n+4]=127;return this._dummyTexture.unlock(),this._dummyTexture},_loadTexture2dAsync:function(e){var n=new System.Threading.Tasks.TaskCompletionSource,i=e.data,a=i[t.filterMode],o=i[t.mipmapCount]>1,s=o?pc.FILTER_NEAREST_MIPMAP_NEAREST:pc.FILTER_NEAREST,l=pc.FILTER_NEAREST;a===UnityEngine.FilterMode.Bilinear?(s=o?pc.FILTER_LINEAR_MIPMAP_NEAREST:pc.FILTER_LINEAR,l=pc.FILTER_LINEAR):a===UnityEngine.FilterMode.Trilinear&&(s=o?pc.FILTER_LINEAR_MIPMAP_LINEAR:pc.FILTER_LINEAR,l=pc.FILTER_LINEAR);var c=i[t.wrapMode]==UnityEngine.TextureWrapMode.Repeat?pc.ADDRESS_REPEAT:pc.ADDRESS_CLAMP_TO_EDGE,d={name:i[t.name]||"",width:i[t.width],height:i[t.height],addressU:c,addressV:c,mipmaps:o,minFilter:s,magFilter:l,autoMipmap:o,rgbm:!!i[t.hdr],anisotropy:Math.min(this.graphicsDevice.maxAnisotropy,i[t.anisoLevel]),format:r[i[t.format]]};if(e.dummy){var u=this._getDummyTexture();return this.registry.Put(e.id,u),System.Threading.Tasks.Task.fromResult(u)}var y=new pc.Texture(this.app.graphicsDevice,d);return this.registry.Put(e.id,y),this.network.GetImageAsync(this._getTextureUrl(e)).continueWith(Bridge.fn.bind(this,(function(e){if(e.status==System.Threading.Tasks.TaskStatus.ranToCompletion){var t=e.result;y.setSource(t),t.remove(),y.mipmaps=d.mipmaps,y.minFilter=d.minFilter,y.magFilter=d.magFilter,y.anisotropy=d.anisotropy,n.setResult(y)}else n.setCanceled()}))),n.task},_getTextureUrl:function(e){return"external"==this.network.resourceConfig.image&&e.id in this.playgroundAssetOverrides?this.playgroundAssetOverrides[e.id]:"assets/bundles/"+e.assetBundleId+"/"+e.id+(e.ext||".png")},unloadAsync:function(e){var n=this.registry.Release(e.id);n&&n.destroy()}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";var t=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Textures.Cubemap"];Bridge.define("LunaUnity.Objects.Handlers.Cubemap",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n,t){return 2===n.type?this._loadCubemapAsync(n):System.Threading.Tasks.Task.fromResult(null)},_loadCubemapAsync:function(e){var n=e.data,i=n[t.size],r=n[t.filterMode],a=n[t.mipmapCount]>0,o=a?pc.FILTER_NEAREST_MIPMAP_NEAREST:pc.FILTER_NEAREST,s=pc.FILTER_NEAREST;r===UnityEngine.FilterMode.Bilinear?(o=a?pc.FILTER_LINEAR_MIPMAP_NEAREST:pc.FILTER_LINEAR,s=pc.FILTER_LINEAR):r===UnityEngine.FilterMode.Trilinear&&(o=a?pc.FILTER_LINEAR_MIPMAP_LINEAR:pc.FILTER_LINEAR,s=pc.FILTER_LINEAR);var l=n[t.wrapMode]==UnityEngine.TextureWrapMode.Repeat?pc.ADDRESS_REPEAT:pc.ADDRESS_CLAMP_TO_EDGE,c=new pc.Texture(this.graphicsDevice,{width:i,height:i,minFilter:o,magFilter:s,addressU:l,addressV:l,anisotropy:Math.min(this.graphicsDevice.maxAnisotropy,n[t.anisoLevel]),cubemap:!0,mipmaps:a,rgbm:!!n[t.hdr],flipY:!0,atlas:this.registry.Get(n[t.atlasId]),rects:n[t.rects]});return c.upload(),this.registry.Put(e.id,c),System.Threading.Tasks.Task.fromResult(c)},unloadAsync:function(e){var n=this.registry.Release(e.id);n&&n.destroy()}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";Bridge.define("LunaUnity.Objects.Handlers.Resources",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n,t){e.deserializeTo(n.data,UnityEngine.Resources,"Luna.Unity.DTO.UnityEngine.Assets.Resources");var i=LunaUnity.Objects.Bundle.handlers.project_settings;return LunaUnity.Objects.Bundle.handlers.prefab_component.load(i.autoInstantiatePrefabs),{}},unloadAsync:function(e){this.registry.Release(e.id)}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";var t=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.TextAsset"];Bridge.define("LunaUnity.Objects.Handlers.TextAsset",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n,i){var r=new UnityEngine.TextAsset;return r.data=n.data[t.data],r.name=n.data[t.name],r.bytes64=n.data[t.bytes64],this.registry.Put(n.id,r),{result:r}},unloadAsync:function(e){this.registry.Release(e.id)}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";Bridge.define("LunaUnity.Objects.Handlers.ScriptableObject",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n,t){try{var i=Deserializers.types[n.class],r=e.d(i,n.data);if(r.name=n.name,!r)return console.warn("Failed to instantiate ScriptableObject of type "+i),System.Threading.Tasks.Task.fromResult(!0);this.registry.Put(n.id,r)}catch(e){console.warn("Cannot put scriptable object with id "+n.id+": "+e)}return{result:r}},unloadAsync:function(e){this.registry.Release(e.id)}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";var t=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Animation.Data.AnimationClip"],i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Animation.Data.AnimationCurve"],r=(Deserializers.fields["Luna.Unity.DTO.UnityEngine.Animation.Data.AnimationCurve+Key"],Deserializers.fields["Luna.Unity.DTO.UnityEngine.Animation.Data.AnimationCurve+ObjectReferenceKey"],Deserializers.fields["Luna.Unity.DTO.UnityEngine.Animation.Data.AnimationEvent"]);Bridge.define("LunaUnity.Objects.Handlers.AnimationClip",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n,a){let o=n.data,s=new UnityEngine.AnimationClip,l=a.find((function(e){return e.manifest.id===n.assetBundleId})).blob;s.name=o[t.name],s.length=o[t.length],s.wrapMode=o[t.wrapMode],s.isLooping=o[t.isLooping];let c=o[t.curves];s.curves=new Array(c.length);for(let n=0;n<c.length;n++){let r=c[n],a=r[i.keys],u=l.slice(a[0],a[0]+a[1]),y=o[t.halfPrecision]?pc.Conversion.fromFloat16ToFloat32(new Uint16Array(u)):new Float32Array(u)||[],p=r[i.objectReferenceKeys]||[],g=new Array(Math.floor(y.length/7)+p.length);for(let e=0;e<y.length;e+=7)g[e/7]=new pc.Keyframe(y[e],y[e+1],y[e+2],y[e+3],y[e+4],y[e+5],y[e+6]);for(let n=0;n<p.length;n++){var d=p[n];g[n+y.length/7]=e.deserializeTo(d,new pc.Keyframe,"Luna.Unity.DTO.UnityEngine.Animation.Data.AnimationCurve+ObjectReferenceKey")}let h={path:r[i.path],componentType:r[i.componentType],property:r[i.property],keyframes:g};s.curves[n]=new pc.AnimationCurve(h),p.length>0&&(s.curves[n].objectCurve=!0)}let u=o[t.events];s.events=new Array(u.length);for(let e=0;e<u.length;e++){let n=u[e],t=new UnityEngine.AnimationEvent;t.functionName=n[r.functionName],t.floatParameter=n[r.floatParameter],t.intParameter=n[r.intParameter],t.stringParameter=n[r.stringParameter],t.time=n[r.time],t.objectReferenceParameter=null,s.events[e]=t}return this.registry.Put(n.id,s),{result:s}},unloadAsync:function(e){this.registry.Release(e.id)}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";var t=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Animations.BlendTree"],i=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Animations.ChildMotion"];Bridge.define("LunaUnity.Objects.Handlers.BlendTree",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n,r){var a=n.data,o=new UnityEditor.Animations.BlendTree;r.find((function(e){return e.manifest.id===n.assetBundleId})).blob;o.name=a[t.name],o.blendParameter=a[t.blendParameter],o.blendParameterY=a[t.blendParameterY],o.blendType=a[t.blendType],o.children=a[t.children],o.useAutomaticThresholds=a[t.useAutomaticThresholds],o.minThreshold=a[t.minThreshold],o.maxThreshold=a[t.maxThreshold];var s=a[t.children];o.children=new Array(s.length);for(var l=0;l<s.length;++l){var c=new UnityEditor.Animations.ChildMotion,d=s[l];e.r(!0,d[i.motion+1],0,c,"motion"),c.position=new pc.Vec2,c.position.x=d[i.position+0],c.position.y=d[i.position+1],c.threshold=d[i.threshold],c.timeScale=d[i.timeScale],c.cycleOffset=d[i.cycleOffset],c.directBlendParameter=d[i.directBlendParameter],c.mirror=d[i.mirror],o.children[l]=c}return this.registry.Put(n.id,o),{result:o}},unloadAsync:function(e){this.registry.Release(e.id)}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";Bridge.define("LunaUnity.Objects.Handlers.AnimatorController",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n,t){n.data;var i=e.d("Luna.Unity.DTO.UnityEngine.Animation.Mecanim.AnimatorController",n.data),r=new UnityEngine.RuntimeAnimatorController.$ctor1(i,this.registry);return this.registry.Put(n.id,r),{result:r}},unloadAsync:function(e){this.registry.Release(e.id)}})})),Bridge.assembly("LunaUnity",(function(e,n){"use strict";var t=Deserializers.fields["Luna.Unity.DTO.UnityEngine.Assets.Font"];Bridge.define("LunaUnity.Objects.Handlers.Font",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},loadAsync:function(e,n,i){var r=n.data,a={name:r[t.name],ascent:r[t.ascent],lineHeight:r[t.lineHeight],fontSize:r[t.fontSize],characterInfo:r[t.characterInfo],texture:this.registry.TryGet(n.data[t.texture+1])},o=new pc.Font(n.font,a);return this.registry.Put(n.id,o),pc.Font.fonts=pc.Font.fonts||{},pc.Font.fonts[n.data[t.name]]=o,pc.Font.fonts[n.data[t.name].replace("-Regular","")]=o,null!=UnityEngine.Font.FontDefault&&"Arial"!=n.data[t.name]||(UnityEngine.Font.FontDefault=new UnityEngine.Font(o)),{result:o}},unloadAsync:function(e){this.registry.Release(e.id)}})})),Bridge.assembly("LunaUnity",(function(e,n){Bridge.define("LunaUnity.Objects.Handlers.PrefabComponent",{inherits:[LunaUnity.Objects.Handlers.Base],ctor:function(e){this.$initialize(),LunaUnity.Objects.Handlers.Base.ctor.call(this,e)},load:function(e){if(!e)for(var n=UnityEngine.Resources.componentToPrefabIds,t=0;t<n.length;t+=2){var i=n[t].toString(),r=n[t+1].toString();this.registry.Put(i,{isPrefabProxy:!0,componentId:i,prefabId:r})}}})})),function(){var e=function(e,n){return this.vector=e,this.offset=n,this};Object.defineProperty(e.prototype,"x",{set:function(e){this.vector.iset(0+this.offset,e)},get:function(){return this.vector.iget(0+this.offset)}}),Object.defineProperty(e.prototype,"y",{set:function(e){this.vector.iset(1+this.offset,e)},get:function(){return this.vector.iget(1+this.offset)}}),Object.defineProperty(UnityEngine.Object.prototype,"m_Enabled",{set:function(e){this.handle.enabled=e>0},get:function(){return this.handle.enabled},configurable:!0}),Object.defineProperty(UnityEngine.UI.RawImage.prototype,"m_Enabled",{set:function(e){this.handle.entity.element._image.enabled=e>0},get:function(){return this.handle.entity.element._image.enabled}}),Object.defineProperty(UnityEngine.UI.Image.prototype,"m_Enabled",{set:function(e){this.handle.entity.element._image.enabled=e>0},get:function(){return this.handle.entity.element._image.enabled}}),Object.defineProperty(UnityEngine.UI.Text.prototype,"m_Enabled",{set:function(e){this.handle.entity.element._text.enabled=e>0},get:function(){return this.handle.entity.element._text.enabled}}),Object.defineProperty(UnityEngine.GameObject.prototype,"m_IsActive",{set:function(e){this.SetActive(e>0)},get:function(){return this.handle._enabled}}),Object.defineProperty(UnityEngine.Transform.prototype,"m_LocalPosition",{get:function(){return this.handle._dirtyLocal=!0,this.handle.localPosition}}),Object.defineProperty(UnityEngine.Transform.prototype,"m_LocalScale",{get:function(){return this.handle._dirtifyLocal(),this.handle.localScale}}),Object.defineProperty(UnityEngine.Transform.prototype,"localEulerAnglesRaw",{get:function(){return this.handle._dirtifyLocal(),this.handle._dirtyLocalEulerAngles=!0,this.handle.localEulerAngles}}),Object.defineProperty(UnityEngine.Transform.prototype,"m_LocalRotation",{get:function(){return this.handle._dirtifyLocal(),this.handle.localRotation}}),Object.defineProperty(UnityEngine.Light.prototype,"m_Intensity",{set:function(e){this.handle.intensity=e},get:function(){return this.handle.intensity}}),Object.defineProperty(UnityEngine.Light.prototype,"m_Color",{get:function(){return this.handle.light.dirtyColor=!0,this.handle.light._color}}),Object.defineProperty(UnityEngine.RectTransform.prototype,"m_AnchoredPosition",{get:function(){return this.handle._dirtifyRect(),this.handle.element._anchoredPosition}}),Object.defineProperty(UnityEngine.RectTransform.prototype,"m_AnchorMin",{get:function(){return this.handle._dirtifyRect(),this._anchorMin=this._anchorMin||new e(this.handle.element._anchors,0)}}),Object.defineProperty(UnityEngine.RectTransform.prototype,"m_AnchorMax",{get:function(){return this.handle._dirtifyRect(),this._anchorMax=this._anchorMax||new e(this.handle.element._anchors,2)}}),Object.defineProperty(UnityEngine.RectTransform.prototype,"m_SizeDelta",{get:function(){return this.handle._dirtifyRect(),this.handle.element._sizeDelta}}),Object.defineProperty(UnityEngine.RectTransform.prototype,"m_Pivot",{get:function(){return this.handle._dirtifyRect(),this.handle.element._pivot}})}(),window.System$Collections$Generic$ICollection$1$Function$contains="contains",window.System$Collections$Generic$ICollection$1$Function$getItem="getItem",window.System$Collections$Generic$ICollection$1$Function$setItem="setItem",window.System$Collections$Generic$ICollection$1$Function$removeItem="removeItem",window.System$Collections$Generic$IDictionary$2$Function$Function$add="add",window.System$Collections$Generic$IDictionary$2$Function$Function$containsKey="containsKey",window.System$Collections$Generic$IDictionary$2$Function$Function$getItem="getItem",window.System$Collections$Generic$IDictionary$2$Function$Function$setItem="setItem",window.System$Collections$Generic$IDictionary$2$Function$Function$removeItem="removeItem",window.pcHierarchyViewer={fn:function(e){return pc.Application.getApplication().root.findByName(e)},f:function(e){return pc.Application.getApplication().root.findByGuid(e)},tryGet:function(e){try{return e()}catch(e){return"exception"}},update:function(e,n){var t=document.createElement("div");t.setAttribute("name",e.name),t.setAttribute("id",e._guid),t.setAttribute("lp",this.tryGet((function(){return e.getLocalPosition().data}))),t.setAttribute("lr",this.tryGet((function(){return e.getLocalEulerAngles_Unity().data}))),t.setAttribute("lrq",this.tryGet((function(){return e.localRotation}))),t.setAttribute("op",this.tryGet((function(){return e.getWorldTransform().transformPoint(new pc.Vec3).data}))),t.setAttribute("ls",this.tryGet((function(){return e.getLocalScale().data}))),t.setAttribute("er",this.tryGet((function(){return e.element.rect}))),t.setAttribute("a",this.tryGet((function(){return e.element.anchor.data}))),t.setAttribute("ap",this.tryGet((function(){return e.element.anchoredPosition.data}))),t.setAttribute("sd",this.tryGet((function(){return e.element.sizeDelta.data}))),t.setAttribute("enabled",this.tryGet((function(){return e.enabled}))),e.constructor==pc.Entity?e.element?(t.setAttribute("type","element"),t.setAttribute("w",e.element.width),t.setAttribute("h",e.element.height),e.element._image&&e.element._image.texture&&t.setAttribute("texture-id",e.element._image.texture.$id)):t.setAttribute("type","entity"):t.setAttribute("type","graph-node");for(var i=0;i<e._children.length;i++){var r=e._children[i];this.update(r,t)}n.appendChild(t)},sync:function(){this.root||(this.root=document.createElement("div"),this.root.id="root",this.root.style.display="none",document.body.appendChild(this.root)),this.update(pc.Application.getApplication().root,this.root)}},Bridge.ns=function(e,n){var t=e.split("."),i=0;if(n||(n=Bridge.global),n==Bridge.global&&(window.$typeCache=window.$typeCache||{},window.$typeCache[e]))return window.$typeCache[e];for(i=0;i<t.length;i++)void 0===n[t[i]]&&(n[t[i]]={}),n=n[t[i]];return n==Bridge.global&&(window.$typeCache[e]=n),n},System.Threading.Tasks.Task.prototype.setSynchronous=function(e){this._synchrounous=e},System.Threading.Tasks.Task.prototype.continueWith=function(e,n){var t=new System.Threading.Tasks.TaskCompletionSource,i=this,r=n?function(){t.setResult(e(i))}:function(){try{t.setResult(e(i))}catch(e){t.setException(System.Exception.create(e))}};return this.isCompleted()?this._synchrounous?r():setTimeout(r,0):this.callbacks.push(r),t.task};var utf8ArrayToStr=function(){var e=new Array(128),n=String.fromCodePoint||String.fromCharCode,t=[];return"undefined"!=typeof TextEncoder?function(e){return e?new TextDecoder("utf-8").decode(e):""}:function(i){var r,a,o=i.length;t.length=0;for(var s=0;s<o;)(a=i[s++])<=127?r=a:a<=223?r=(31&a)<<6|63&i[s++]:a<=239?r=(15&a)<<12|(63&i[s++])<<6|63&i[s++]:String.fromCodePoint?r=(7&a)<<18|(63&i[s++])<<12|(63&i[s++])<<6|63&i[s++]:(r=63,s+=3),t.push(e[r]||(e[r]=n(r)));return t.join("")}}();!function(){"use strict";let e=new Uint32Array(2048),n=new Uint32Array(64),t=new Uint32Array(64),i={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",alegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};e[0]=0;for(let n=1;n<1024;++n){let t=n<<13,i=0;for(;0==(8388608&t);)i-=8388608,t<<=1;t&=-8388609,i+=947912704,e[n]=t|i}for(let n=1024;n<2048;++n)e[n]=939524096+(n-1024<<13);t[0]=0;for(let e=1;e<31;++e)t[e]=e<<23;t[31]=1199570944,t[32]=2147483648;for(let e=33;e<63;++e)t[e]=2147483648+(e-32<<23);t[63]=3347054592,n[0]=0;for(let e=1;e<64;++e)n[e]=32===e?0:1024;let r=function(){};r.fromFloat16ToFloat32=function(i){let r=new Float32Array(i.length),a=new Uint32Array(r.buffer);for(let r=0;r<i.length;r++){let o=i[r],s=o>>10;a[r]=e[n[s]+(1023&o)]+t[s]}return r},r.tryParseHtmlString=function(e,n){if("#"===e[0])return n.fromString(e),!0;var t=e.toLowerCase();return!(!/^[a-z]+$/.test(t)||!(t=i[t]))&&(n.fromString(t),!0)},pc.Conversion=r}(),String.prototype.uncapitalize=function(){return""===this?this:this[0].toLowerCase()+this.substring(1)},Luna.Unity.NativeShare.IsShareAvailable=!!navigator.share,Luna.Unity.NativeShare.Share=function(e,n,t){const i={title:e,text:n,url:t};navigator.share(i)},pc.extend(pc,function(){var e=function(){this.boxProjection=!1,this.cubemap=new pc.Texture(UnityEngine.Graphics.graphicsDevice,{cubemap:!0,rgbm:!1}),this.position=new pc.Vec4,this.min=new pc.Vec4,this.max=new pc.Vec4,this.box={min:new pc.Vec4,max:new pc.Vec4,position:new pc.Vec4}};return pc.extend(e.prototype,{getBox:function(e){return this.box.min.copy(this.min),this.box.max.copy(this.max),this.box.position.copy(this.position),this.boxProjection,this.box}}),{ReflectionProbeData:e}}()),Object.assign(pc,function(){const e=Object.create(null),n=["#FFFFFF","#F0A3FF","#0075DC","#993F00","#4C005C","#191919","#005C31","#2BCE48","#FFCC99","#808080","#94FFB5","#8F7C00","#9DCC00","#C20088","#003380","#FFA405","#FFA8BB","#426600","#FF0010","#5EF1F2","#00998F","#E0FF66","#740AFF","#990000","#FFFF80","#FFFF00","#FF5005"];let t=0,i={},r={},a={};function o(e){return n[e%n.length]}function s(e){return void 0===e.z?new pc.Vec3(e.x,e.y,e.z):e}function l(e,n){const t=pc.Application.getApplication().getMainCamera().worldToScreen(e);return new pc.Vec2(t.x,n.canvas.height/window.devicePixelRatio-t.y)}function c(e){const n=document.getElementById("application-canvas");return e.setAttribute("width",n.getAttribute("width")),e.setAttribute("height",n.getAttribute("height")),e}function d(){const e=document.getElementById("debug-canvas");return e?c(e).getContext("2d"):function(){const e=document.createElement("canvas");e.id="debug-canvas",e.style.position="absolute",e.style.top="0",document.body.appendChild(e);const n=()=>{c(e),y(),window.requestAnimationFrame(n)};return window.requestAnimationFrame(n),c(e)}().getContext("2d")}function u(e,n){const[t,i,r]=e,a=l(s(t),n),o=l(s(i),n);n.beginPath(),n.moveTo(a.x,a.y),n.lineTo(o.x,o.y),n.strokeStyle=r,n.stroke()}function y(){const e=d();Object.values(i).forEach(n=>u(n,e)),Object.values(r).forEach(n=>(function(e,n){const[t,i]=e,r=s(t.min),a=s(t.max);u([r,new pc.Vec3(a.x,r.y,r.z),i],n),u([new pc.Vec3(r.x,a.y,r.z),new pc.Vec3(a.x,a.y,r.z),i],n),u([r,new pc.Vec3(r.x,a.y,r.z),i],n),u([new pc.Vec3(a.x,r.y,r.z),new pc.Vec3(a.x,a.y,r.z),i],n),u([r,new pc.Vec3(r.x,r.y,a.z),i],n),u([new pc.Vec3(r.x,a.y,r.z),new pc.Vec3(r.x,a.y,a.z),i],n),u([new pc.Vec3(r.x,r.y,a.z),new pc.Vec3(r.x,a.y,a.z),i],n),u([a,new pc.Vec3(r.x,a.y,a.z),i],n),u([a,new pc.Vec3(a.x,r.y,a.z),i],n),u([a,new pc.Vec3(a.x,a.y,r.z),i],n),u([new pc.Vec3(a.x,r.y,a.z),new pc.Vec3(a.x,r.y,r.z),i],n),u([new pc.Vec3(a.x,r.y,a.z),new pc.Vec3(r.x,r.y,a.z),i],n)})(n,e)),Object.values(a).forEach(n=>(function(e,n,t=!1){const[i,r]=e,a=i._component._body;if(!a)return;const c=a.shape.getChildWithShape(i.uid);if(!c)return void console.warn("Orphan shape");const d=pc.Application.getApplication().getMainCamera()["__UnityEngine.Camera"].transform.forward,y=new Goblin.Vector3;y.set(d.x,d.y,d.z),y.normalize();for(let e=0;e<i.faces.length;e++){const d=i.faces[e],p=[];let g=d.edge;const h=new Goblin.Vector3;if(h.copy(d.normal),c.transform.rotateVector3(h),a.transform.rotateVector3(h),h.normalize(),!(h.dot(y)>.5)){do{const e=new Goblin.Vector3;e.copy(g.getTail().position),c.transform.transformVector3(e),a.transform.transformVector3(e),p.push(e),g=g.next}while(g!==d.edge);if(t){n.beginPath();const t=l(s(p[0]),n);n.moveTo(t.x,t.y);for(let e=1;e<p.length;e++){const t=l(s(p[e]),n);n.lineTo(t.x,t.y)}n.closePath(),n.fillStyle=r||o(e),n.fill()}else for(let t=0;t<p.length;t++){u([p[t],t===p.length-1?p[0]:p[t+1],r||o(e)],n)}}}})(n,e,!0))}return e.addLine=function(e,n="green",r="green"){const a=[Array.isArray(e)?e[0]:e,Array.isArray(e)?e[1]:n,"string"==typeof n?n:r],o=t++;return i[o]=a,y(),o},e.removeLine=function(e){delete i[e]},e.addAABB=function(e,n="green"){const i=void 0===e.min?{min:e[0],max:e[1]}:e,a=t++;return r[a]=[i,n],y(),a},e.removeAABB=function(e){delete r[e]},e.addGoblinConvexHull=function(e,n=null){const i=t++;return a[i]=[e,n],y(),i},e.removeGoblinConvexHull=function(e){delete a[e]},e.clear=function(){i={},r={},a={}},{debugDraw:e}}()),UnityEngine.Mathf.Max=Math.max,UnityEngine.Mathf.Min=Math.min,pc.ScreenComponent.prototype.unityClass=UnityEngine.Canvas,pc.CanvasRendererComponent.prototype.unityClass=UnityEngine.CanvasRenderer,pc.CameraComponent.prototype.unityClass=UnityEngine.Camera,pc.LightComponent.prototype.unityClass=UnityEngine.Light,pc.AnimationComponent.prototype.unityClass=UnityEngine.Animation,pc.AnimatorComponent.prototype.unityClass=UnityEngine.Animator,pc.VideoPlayerComponent.prototype.unityClass=UnityEngine.Video.VideoPlayer,pc.ReflectionProbeComponent.prototype.unityClass=UnityEngine.ReflectionProbe,pc.ParticleSystemComponent.prototype.unityClass=UnityEngine.ParticleSystem,pc.ParticleSystemRendererComponent.prototype.unityClass=UnityEngine.ParticleSystemRenderer,pc.AudioSourceUnityComponent.prototype.unityClass=UnityEngine.AudioSource,pc.MeshFilterComponent.prototype.unityClass=UnityEngine.MeshFilter,pc.Rigidbody2DComponent.prototype.unityClass=UnityEngine.Rigidbody2D,pc.SpringJoint2DComponent.prototype.unityClass=UnityEngine.SpringJoint2D,pc.DistanceJoint2DComponent.prototype.unityClass=UnityEngine.DistanceJoint2D,pc.FixedJoint2DComponent.prototype.unityClass=UnityEngine.FixedJoint2D,pc.HingeJoint2DComponent.prototype.unityClass=UnityEngine.HingeJoint2D,pc.WheelJoint2DComponent.prototype.unityClass=UnityEngine.WheelJoint2D,pc.FrictionJoint2DComponent.prototype.unityClass=UnityEngine.FrictionJoint2D,pc.RelativeJoint2DComponent.prototype.unityClass=UnityEngine.RelativeJoint2D,pc.SliderJoint2DComponent.prototype.unityClass=UnityEngine.SliderJoint2D,pc.TargetJoint2DComponent.prototype.unityClass=UnityEngine.TargetJoint2D,pc.BoxCollider2DComponent.prototype.unityClass=UnityEngine.BoxCollider2D,pc.CircleCollider2DComponent.prototype.unityClass=UnityEngine.CircleCollider2D,pc.CapsuleCollider2DComponent.prototype.unityClass=UnityEngine.CapsuleCollider2D,pc.EdgeCollider2DComponent.prototype.unityClass=UnityEngine.EdgeCollider2D,pc.PolygonCollider2DComponent.prototype.unityClass=UnityEngine.PolygonCollider2D,pc.RigidbodyComponent.prototype.unityClass=UnityEngine.Rigidbody,pc.BoxColliderComponent.prototype.unityClass=UnityEngine.BoxCollider,pc.SphereColliderComponent.prototype.unityClass=UnityEngine.SphereCollider,pc.MeshColliderComponent.prototype.unityClass=UnityEngine.MeshCollider,pc.CapsuleColliderComponent.prototype.unityClass=UnityEngine.CapsuleCollider,pc.WheelColliderComponent.prototype.unityClass=UnityEngine.WheelCollider,pc.CharacterControllerComponent.prototype.unityClass=UnityEngine.CharacterController;